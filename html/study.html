<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study - Bammoozle</title>
    
    <!-- CSS -->
    <link href="../css/base.css" rel="stylesheet">
    <link href="../css/components.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen">

    <!-- Navegaci√≥n -->
    <header class="header">
        <nav class="nav">
            <div class="flex items-center space-x-8">
                <a href="../index.html" class="nav-brand hover:opacity-70">
                    <svg width="29" height="29" viewBox="0 0 29 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.12499 15.8749H3.49999V25.4999C3.49999 27.0124 4.73749 28.2499 6.24999 28.2499H22.75C24.2625 28.2499 25.5 27.0124 25.5 25.4999V15.8749H26.875C27.425 15.8749 27.9337 15.5449 28.14 15.0224C28.3462 14.5137 28.2362 13.9224 27.8375 13.5237L15.4762 1.14869C15.349 1.02123 15.1979 0.920097 15.0316 0.851098C14.8653 0.782098 14.6869 0.746582 14.5069 0.746582C14.3268 0.746582 14.1485 0.782098 13.9821 0.851098C13.8158 0.920097 13.6647 1.02123 13.5375 1.14869L1.14874 13.5237C0.749992 13.9224 0.639992 14.5137 0.846242 15.0224C1.05249 15.5312 1.56124 15.8749 2.11124 15.8749H2.12499ZM14.5 4.06369L22.75 12.3137V25.4999H6.24999V12.3137L14.5 4.06369Z" fill="#ECECEC"/>
                    </svg>
                </a>
                
                <div class="nav-links">
                    <a href="#" class="nav-link">Games</a>
                    <a href="#" class="nav-link">Blog</a>
                    <a href="#" class="nav-link">Class PIN</a>
                </div>
            </div>
            
            <div class="nav-links">
                <a href="#" class="nav-link">Sign in</a>
                <a href="#" class="btn btn-info btn-sm btn-rounded">Join for Free</a>
            </div>
            
            <button id="hamburger-btn" class="hamburger">‚ò∞</button>
        </nav>
    </header>

    <!-- T√≠tulo de la p√°gina -->
    <div class="bg-bam-yellow text-bam-dark p-6">
        <div class="container flex justify-between items-center flex-wrap gap-4">
            <div>
                <h1 class="text-4xl font-bold">Study</h1>
                <p class="font-semibold">Verbs followed by gerunds or infinitive (no diff...)</p>
            </div>
            <div class="flex items-center space-x-2">
                <div class="text-right">
                    <p class="font-bold text-sm">Translate the page</p>
                    <div class="flex gap-1 mt-1">
                        <button class="btn btn-sm bg-white border-2 border-bam-green-dark text-bam-green-dark">Spanish</button>
                        <button class="btn btn-sm bg-bam-green-dark text-white">English</button>
                    </div>
                </div>
                <div class="bg-bam-green rounded-full p-2 w-10 h-10 flex items-center justify-center">
                    <span class="text-white font-bold text-2xl">?</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main class="container grid grid-cols-1 lg:grid-cols-3 gap-8 p-4 md:p-8">
        
        <!-- Columna Izquierda: Monitoring Center -->
        <aside class="lg:col-span-1 space-y-6">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Monitoring Center:</h2>
                    <p class="card-subtitle">See the progress of your study session.</p>
                </div>
                
                <div class="card-body">
                    <div class="bg-bam-cyan text-white rounded-lg p-4 mb-4">
                        <p class="font-bold">Progress Percentage</p>
                        <div class="flex items-center gap-4">
                            <svg class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-10.293a1 1 0 00-1.414-1.414L9 9.586 7.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <p id="progress-percentage" class="text-5xl font-bold">0%</p>
                        </div>
                    </div>

                    <div class="space-y-2 text-lg font-semibold mb-6">
                        <div class="flex justify-between">
                            <span>‚ùå Wrong:</span> 
                            <span id="wrong-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üîç Seen:</span> 
                            <span id="seen-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>‚úî Correct:</span> 
                            <span id="correct-count">0</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="font-bold mb-2">How to study:</h3>
                        <p class="text-sm text-gray-500">Read the statement and make your answer, then check if it's correct after pressing the magnifying glass.</p>
                    </div>
                </div>
                
                <div class="card-footer">
                    <div class="grid grid-cols-1 gap-3 w-full">
                        <button id="restart-button" class="btn btn-danger btn-lg">Restart</button>
                        <button class="btn btn-primary btn-lg" onclick="window.location.href='game-main.html'">Back</button>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Columna Derecha: Tarjetas de Estudio -->
        <div class="lg:col-span-2">
            <div class="flex justify-between items-start mb-4 flex-wrap gap-y-2">
                <div class="flex items-center gap-2">
                    <h2 class="text-2xl font-bold">What you will see in this game:</h2>
                    <div class="bg-bam-green rounded-full p-1 w-6 h-6 flex items-center justify-center">
                        <span class="text-white font-bold text-md">?</span>
                    </div>
                </div>
            </div>
            <p class="text-sm text-gray-500 -mt-2 mb-4">These are the cards that will be in the game, here you can familiarize with them. Each one of them has a score (by default it's 15).</p>
            
            <div id="study-cards-container" class="grid-responsive cols-2">
                <!-- Tarjetas se generan con JavaScript -->
            </div>
        </div>
    </main>

    <!-- Men√∫ m√≥vil -->
    <div id="mobile-menu" class="mobile-menu">
        <button id="close-menu-btn" class="mobile-menu-close">&times;</button>
        <nav class="mobile-menu-links">
            <a href="#" class="mobile-menu-link">Games</a>
            <a href="#" class="mobile-menu-link">Blog</a>
            <a href="#" class="mobile-menu-link">Class PIN</a>
            <hr class="border-gray-600 my-4"/>
            <a href="#" class="mobile-menu-link">Sign in</a>
            <a href="#" class="btn btn-primary btn-rounded text-center">Join for Free</a>
        </nav>
    </div>

    <!-- Scripts -->
    <script src="../js/utils.js"></script>
    <script src="../js/ui.js"></script>
    <script src="../js/game.js"></script>
    <script>
        // L√≥gica espec√≠fica para la p√°gina de estudio
        document.addEventListener('DOMContentLoaded', function() {
            const { GameData, StudyController } = window.BammoozleGame;
            const studyCardsContainer = document.getElementById('study-cards-container');
            
            // Generar tarjetas de estudio
            if (studyCardsContainer && GameData) {
                GameData.questions.forEach((question, index) => {
                    const card = document.createElement('div');
                    card.className = 'study-card card';
                    card.innerHTML = `
                        <div class="card-body">
                            <p class="text-lg mb-4">${question.question}</p>
                        </div>
                        <div class="card-footer">
                            <p class="font-bold text-bam-grey-dark">v ${question.points}</p>
                            <button class="btn btn-primary btn-icon study-answer-btn" data-index="${index}">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                    studyCardsContainer.appendChild(card);
                });
                
                // A√±adir eventos a los botones de respuesta
                const answerButtons = document.querySelectorAll('.study-answer-btn');
                answerButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = parseInt(btn.dataset.index);
                        StudyController.showAnswer(index);
                    });
                });
            }
            
            // Inicializar el controlador de estudio
            StudyController.init();
        });
        // üîß FIX TEMPORAL PARA MODALES - A√±adir este script al final de study.html

// Funci√≥n simple y directa para cerrar modales
function closeAnyModal() {
    console.log('üîß Cerrando modal...');
    
    // Buscar todos los modales visibles
    const modals = document.querySelectorAll('.modal-backdrop');
    
    modals.forEach(modal => {
        if (!modal.classList.contains('hidden')) {
            modal.classList.add('hidden');
            console.log('‚úÖ Modal cerrado:', modal.id);
            
            // Si es din√°mico, eliminarlo
            if (modal.id.includes('study-answer-modal') || 
                modal.id.includes('dynamic-modal') ||
                modal.id.includes('question-modal')) {
                setTimeout(() => {
                    if (document.body.contains(modal)) {
                        document.body.removeChild(modal);
                        console.log('üóëÔ∏è Modal eliminado del DOM');
                    }
                }, 300);
            }
        }
    });
    
    // Restaurar scroll
    document.body.style.overflow = '';
    
    // Limpiar estado si existe
    if (window.BammoozleUI?.ModalSystem) {
        window.BammoozleUI.ModalSystem.currentModal = null;
    }
}

// Interceptar todos los clics en la p√°gina
document.addEventListener('click', function(e) {
    // Si se hace clic en el fondo del modal
    if (e.target.classList.contains('modal-backdrop')) {
        console.log('üñ±Ô∏è Clic en backdrop detectado');
        closeAnyModal();
        return;
    }
    
    // Si se hace clic en cualquier bot√≥n que parezca de cerrar
    const target = e.target;
    const isCloseButton = 
        target.textContent.includes('Cerrar') ||
        target.textContent.includes('√ó') ||
        target.classList.contains('close-modal-btn') ||
        target.id.includes('close') ||
        target.closest('.close-modal-btn');
    
    if (isCloseButton) {
        console.log('üñ±Ô∏è Bot√≥n de cerrar detectado');
        e.preventDefault();
        e.stopPropagation();
        closeAnyModal();
    }
});

// Cerrar con ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        console.log('‚å®Ô∏è ESC presionado');
        closeAnyModal();
    }
});

// Sobrescribir el sistema original si existe
if (window.BammoozleUI?.ModalSystem) {
    const originalCloseModal = window.BammoozleUI.ModalSystem.closeModal;
    
    window.BammoozleUI.ModalSystem.closeModal = function() {
        console.log('üîÑ Usando sistema de cierre mejorado');
        closeAnyModal();
    };
    
    console.log('‚úÖ Sistema de modales sobrescrito');
}

// Funci√≥n global para usar desde la consola
window.closeModal = closeAnyModal;

console.log('üöÄ Fix de modales cargado. Usa closeModal() en consola si hay problemas.');
    </script>
    
</body>
</html>

